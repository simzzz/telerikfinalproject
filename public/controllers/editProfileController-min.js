import{templates}from"templates";import{userController}from"userController";import{UserRequester}from"userRequester";const USERNAME_MIN_LENGTH=2,USERNAME_MAX_LENGTH=20,editProfileController=function(e){templates.getPage("editProfile",e).done(()=>{$("#dropdownMenuLink").click(()=>{$("#dropdownMenu").hasClass("hidden")?$("#dropdownMenu").removeClass("hidden"):$("#dropdownMenu").addClass("hidden")}),$("#title").hmtl("Edit your Profile");const r=$("#editBtn");$("#emailChangeInput").on("change",()=>{$("#passwordInput").prop("disabled",!1).focus()}),r.on("click",()=>{const r=$("#usernameChangeInput").val(),t=$("#emailChangeInput").val(),s=$("#passwordInput").val(),o=new UserRequester;if(r!==e.displayName){if(/[^a-zA-Z0-9 ]+/g.test(r))return toastr.error("The username can contain only characters, digits and space"),void $("#usernameChangeInput").focus();if(!(2<r.length&&r.length<20))return toastr.error(`The username should be between 2 and 20 characters long!`),void $("#usernameChangeInput").focus();const e=o.currentUser.updateProfile({displayName:r});toastr.success(`Your username is now ${r}`),e.then(()=>{location.hash="/user"})}if(""!==t.trim&&t!==e.email)if(""===s.trim())toastr.error("Please enter your password!");else{const r=firebase.auth.EmailAuthProvider.credential(e.email,s),n=o.currentUser;Promise.resolve(n.reauthenticateWithCredential(r)).then(()=>{Promise.resolve(n.updateEmail(t)).then(()=>{toastr.success("You have changed your email successfully!"),location.hash="/user"},function(e){toastr.error(`${e.message}`)})},function(e){toastr.error(`${e.message}`)})}})})};export{editProfileController};